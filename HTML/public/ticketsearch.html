<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- 10. 文件相關資訊 -->
  <meta name="description" content="Free Web tutorials">
  <meta name="keywords" content="HTML, CSS, JavaScript">
  <meta name="author" content="Liu">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- 安插bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>



  <!-- 安插jquery -->
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript">

  </script>


  <!-- 網頁標題icon -->
  <link rel="icon" href="./長榮航空img/unicon.png" type="image/x-icon" />
  <link rel="shortcut icon" href="./長榮航空img/unicon.png" type="image/x-icon" />

  <link rel="stylesheet" href="./animation.css">
  <title>航空首頁</title>

  <!-- 安插登入按鈕的css -->
  <link rel="stylesheet" href="./個樣式css資料/登入按鈕.css">

  <!-- 表格美化css -->
  <style>
    /* 通用邊框和間距 */
    fieldset {
      border: 2px solid #ddd;
      border-radius: 4px;
    }

    /* 標題和欄位頭 */
    legend {
      font-size: 1.2em;
      font-weight: bold;
    }

    /* 表格樣式 */
    .table-striped tbody tr:nth-of-type(odd) {
      background-color: rgba(0, 0, 0, .05);
    }

    /* 表頭 */
    .bg-success {
      background-color: #28a745 !important;
    }

    .text-white {
      color: #fff !important;
    }
  </style>

</head>

<body>
  <!-- 移動式標題列 -->
  <nav class="navbar navbar-expand-lg bg-light fixed-top ">
    <!-- 飛機logo首頁 -->
    <div class="d-flex jutisfy-content-start"> <a href="./index.html">
        <img src="./img/logo-evaair-header.png" alt="長榮logo" class="img-fluid w-75">
      </a>
    </div>

    <!-- 下拉式標題 -->
    <div class="container-fluid">

      <ul class="navbar-nav me-auto mb-2 mb-lg-0 d-flex justify-content-between  w-50">
        <li class="nav-item dropdown ">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            企業商務旅行
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">主題活動</a></li>
            <li><a class="dropdown-item" href="#">熱門活動</a></li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="#">限時促銷</a></li>
          </ul>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            機票與訂位管理
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">登入</a></li>
            <li><a class="dropdown-item" href="#">訂位</a></li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li>
              <a class="dropdown-item" href="#">取消全部行程</a>
            </li>
          </ul>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            行程管理
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">機票定位</a></li>
            <li><a class="dropdown-item" href="#">管理行程</a></li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="#">其他</a></li>
          </ul>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            無限萬里遊
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">航班到離查詢</a></li>
            <li><a class="dropdown-item" href="#">機場服務</a></li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="#">特別需求與協助</a></li>
          </ul>
      </ul>


      <!-- 登入及註冊 -->
      <nav id="loginop">
        <div class="user-menu">
          <!-- 使用者名稱與下拉箭頭 -->
          <div id="user-info" class="btn">
            <span id="username">使用者名稱</span>
            <span id="arrow">&#9660;</span>
          </div>
          <!-- 下拉式選單 -->
          <div id="dropdown-content">
            <a href="#" id="profile-link">會員頁面</a>
            <a href="#" id="logout-link">登出</a>
          </div>
        </div>
      </nav>

      <!-- 登入及註冊 -->
      <div class="ms-auto">
        <a href="./login.html" id="toLogin" class="btn">登入</a>
        <span>|</span>
        <a href="./regis.html" class="btn">註冊</a>
      </div>
  </nav>

  <!-- 選擇欄位 -->
  <!-- 顯示欄位 -->
  <div class="container mt-5">
    <fieldset class="border p-4">
      <legend class="w-auto px-2">訂單代號: <span id="vicketId"></span></legend>
      <legend class="w-auto px-2">訂位代號: <span id="orderid"></span></legend>
      <table id="jobList" class="table table-striped">
        <thead>
          <tr>
            <th colspan="4">
              <h5 id="th_date">(網路購票) <span id="gotype">幾段航班 </span><br><span id="AD">0</span>大人/ <span
                  id="CH">0</span>小孩/ <span id="BA">0</span>嬰兒</h5>
            </th>
            <th>
              <a class="btn btn-danger" id="delete">取消訂單</a>
            </th>
          </tr>
          <tr class="bg-success text-white">
            <td>起飛(當地時間)</td>
            <td>啟程地</td>
            <td>目的地</td>
            <td>艙種類</td>
            <td>機位狀態</td>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr>
            <td id="flight_time_1">起飛當地時間</td>
            <td id="departure_1">啟程地</td>
            <td id="destination_1">目的地</td>
            <td id="cabinType_1">目的地</td>
            <td id="sit_status_1">已確認</td>
          </tr>
          <tr id="back_tr">
            <td id="flight_time_2">回程當地時間</td>
            <td id="departure_2">啟程地</td>
            <td id="destination_2">目的地</td>
            <td id="cabinType_2">目的地</td>
            <td id="sit_status_2">已確認</td>
          </tr>
        </tbody>
      </table>
    </fieldset>
  </div>


  <script type="text/javascript" src="search.js"></script>








  <script>
    //    這裡寫載入時讀取資料
    $(document).ready(function () {
      var ordersearch = new URLSearchParams(window.location.search);
      var orderId = ordersearch.get("id");
      var url = "/order/book/" + orderId
      console.log(url)
      $.get(url, function (e) {
        let item = e;
        $("#vicketId").text(item.vicketId.substring(0, 4));
        $("#orderid").text(item.orderId);
        $("#gotype").text(item.ticketype);
        $("#AD").text(item.AD);
        $("#CH").text(item.CH);
        $("#BA").text(item.BA);
        $("#flight_time_1").text(item.flightInfo.godate);
        $("#departure_1").text(item.flightInfo.goairport);
        $("#destination_1").text(item.flightInfo.godestination);
        $("#cabinType_1").text(item.cabintype_1);
        $("#sit_status_1").text("已確認");
        $("#flight_time_2").text(item.flightInfo.backdate);
        $("#departure_2").text(item.flightInfo.backairport);
        $("#destination_2").text(item.flightInfo.backdestination);
        $("#cabinType_2").text(item.cabintype_2);
        $("#sit_status_2").text("已確認");
        console.log(e);
        console.log(item.flightInfo.total_price);
        console.log(item.flightInfo.total_price);
        // 發送 GET 請求到伺服器路由，使用英文縮寫    

        //  確認是否為單程票
        var confirm = item.ticketype
        if (confirm === "2個航段") {
          $("#back_div").css("display", "block")
        } else if (confirm === "1個航段") {
          $("#back_div").css("display", "none")
          $("#back_tr").empty()
        }
        else {
          // 先砍掉原本文字
          $(document).ready(function () {
            $("#tbody").empty();
          })
        }
      })
    });

    // 刪除訂單
    $("#delete").on("click", function () {
var isConfirmed = confirm("您確定要取消此筆機票預訂嗎?");

if (isConfirmed) {

      var deleteVID = $("#vicketId").text();
      var deleteOID = $("#orderid").text()
      var result = $.ajax({
        type: "delete",
        url: "/bookinfo/delete/",
        data: { deleteVID: deleteVID, deleteOID: deleteOID },
        success: function (response) {
          alert(response);
        window.location.reload();

        },
      }
      )} else{

      }

    })
  </script>


  <!-- 這個是關於登入切換的js檔案 -->
  <script type="text/javascript" src="nav.js"></script>
  <!-- 返回頂部按鈕 -->
  <a href="#top" target="" style="cursor: pointer;">
    <figure id="smart" class="position-fixed bottom-0 end-0">
      <img src="./img/bot.gif" style="object-fit: contain; height: 70px; width:70px; z-index: 1;">
      <figcaption style="font-size:17px; text-align: center;"></figcaption>
    </figure>
  </a>
  <script type="text/javascript" src="./js資料庫/向上移動.js"></script>


</body>

</html>