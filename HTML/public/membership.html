<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>會員</title>
    <meta name="description" content="Free Web tutorials" />
    <meta name="keywords" content="HTML, CSS, JavaScript" />
    <meta name="author" content="Liu" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <!-- 網頁標題icon -->
    <link rel="icon" href="./長榮航空img/unicon.png" type="image/x-icon" />
    <link rel="shortcut icon" href="./長榮航空img/unicon.png" type="image/x-icon" />
    <!-- 安插jquery -->
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript">

    </script>



    <!-- 安插登入按鈕的css -->
    <link rel="stylesheet" href="./個樣式css資料/登入按鈕.css">


    <!-- 會員表格的css -->
    <style>
        .member-card .card-image {
            width: 50%;
            height: auto;
        }

        .promotion-section,
        .progress-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, .1);
        }

        .progress-bar {
            background-color: #28a745;
            transition: width 0.6s ease;
        }

        .btn-success {
            color: #fff;
            background-color: #28a745;
            border-color: #28a745;
        }

        .btn-success:hover {
            color: #fff;
            background-color: #218838;
            border-color: #1e7e34;
        }

        .btn-primary {
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
        }

        .btn-primary:hover {
            color: #fff;
            background-color: #0069d9;
            border-color: #0062cc;
        }
    </style>
    <!-- /* 會員資料卡片風格 */ -->
    <style>
        .card {
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        }

        .card-header {
            background-color: #f7f7f7;
        }

        .form-label {
            font-weight: bold;
        }

        .form-control {
            border-radius: 0.25rem;
        }

        #updateProfile {
            width: 50%;
            padding: 0.375rem 0.75rem;
        }

        /* 顯示密碼的切換 */
        .toggle-password {
            cursor: pointer;
        }
    </style>

</head>

<body>
    <!-- 移動式標題列 -->
    <nav class="navbar navbar-expand-lg bg-light fixed-top ">
        <!-- 飛機logo首頁 -->
        <div class="d-flex jutisfy-content-start"> <a href="./index.html">
                <img src="./img/logo-evaair-header.png" alt="長榮logo" class="img-fluid w-75">
            </a>
        </div>

        <!-- 下拉式標題 -->
        <div class="container-fluid">

            <ul class="navbar-nav me-auto mb-2 mb-lg-0 d-flex justify-content-between  w-50">
                <li class="nav-item dropdown ">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        企業商務旅行
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">主題活動</a></li>
                        <li><a class="dropdown-item" href="#">熱門活動</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="#">限時促銷</a></li>
                    </ul>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        機票與訂位管理
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">登入</a></li>
                        <li><a class="dropdown-item" href="#">訂位</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <a class="dropdown-item" href="#">取消全部行程</a>
                        </li>
                    </ul>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        行程管理
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">機票定位</a></li>
                        <li><a class="dropdown-item" href="#">管理行程</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="#">其他</a></li>
                    </ul>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        無限萬里遊
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">航班到離查詢</a></li>
                        <li><a class="dropdown-item" href="#">機場服務</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="#">特別需求與協助</a></li>
                    </ul>
            </ul>


            <!-- 登入及註冊 -->
            <nav id="loginop">
                <div class="user-menu">
                    <!-- 使用者名稱與下拉箭頭 -->
                    <div id="user-info" class="btn">
                        <span id="username">使用者名稱</span>
                        <span id="arrow">&#9660;</span>
                    </div>
                    <!-- 下拉式選單 -->
                    <div id="dropdown-content">
                        <a href="#" id="profile-link">會員頁面</a>
                        <a href="#" id="logout-link">登出</a>
                    </div>
                </div>
            </nav>

            <!-- 登入及註冊 -->
            <div class="ms-auto">
                <a href="./login.html" id="toLogin" class="btn">登入</a>
                <span>|</span>
                <a href="./regis.html" class="btn">註冊</a>
            </div>
    </nav>



    <!-- 會員畫面 -->

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div class="member-card card shadow-sm">
                    <div class="card-body">
                        <div class="text-center">
                            <h1 class="card-title">會員卡</h1>
                            <img src="./長榮航空img/綠卡.png" alt="會員卡" class="card-image mb-3">
                            <h3 id="cardLevel">綠卡</h3>
                            <p class="card-text">會員卡號：<span id="cardID">3342791001</span></p>
                            <p class="card-text">有效期限：永久有效</p>
                            <a href="#" class="btn btn-success" id="profileChange">會員資料更改</a>
                        </div>
                    </div>
                </div>
                <div class="progress-section mt-4">
                    <h2>晉升卡籍</h2>
                    <p>現會籍效期連續12個月內，計算區間：2023年11月16日-2024年11月15日，截止日：2024年11月15日。不含五日內累計之宇宙聯盟航班哩程。</p>
                    <div class="progress mb-2">
                        <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0"
                            aria-valuemin="0" aria-valuemax="30000" id="mileagebar" ></div>
                    </div>
                    <p class="text-center"><span id="mileage">0</span>/30,000 哩</p>
                    <div class="progress mb-2">
                        <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0"
                            aria-valuemin="0" aria-valuemax="10" id="fligtcountbar"></div>
                    </div>
                    <p class="text-center"><span id="fligtcount">0</span>/10 有效航段</p>
                </div>
            </div>
        </div>
    </div>



    <!-- 會員資料區 -->
    <div class="container mt-5" id="profileData" style="display: none;">
        <div class="card">
            <div class="card-header">
                個人資料
                <small class="text-muted">基本資料包含您的個人資料與E-mail、手機號碼等聯絡資料。</small>
            </div>
            <div class="card-body">
                <form id="profileDataForm">
                    <!-- 護照上的英文姓 -->
                    <div class="mb-3">
                        <label for="en_fname" class="form-label">護照上的英文姓:</label>
                        <input type="text" class="form-control" id="en_fname" value="LIU">
                    </div>
                    <!-- 護照上的英文名 -->
                    <div class="mb-3">
                        <label for="en_name" class="form-label">護照上的英文名:</label>
                        <input type="text" class="form-control" id="en_name" value="WE***N">
                    </div>
                    <!-- 會員卡籍 -->
                    <div class="mb-3">
                        <label class="form-label">會員卡籍:</label>
                        <p id="cardLevelName" class="form-text">GC</p>
                    </div>
                    <!-- 會員卡號 -->
                    <div class="mb-3">
                        <label class="form-label">會員卡號:</label>
                        <p id="cardIDch" class="form-text">3342791001</p>
                    </div>
                    <!-- 中文姓 -->
                    <div class="mb-3">
                        <label for="ch_fname" class="form-label">中文姓:</label>
                        <input type="text" class="form-control" id="ch_fname" value="劉">
                    </div>
                    <!-- 中文名 -->
                    <div class="mb-3">
                        <label for="ch_name" class="form-label">中文名:</label>
                        <input type="text" class="form-control" id="ch_name" value="*亨">
                    </div>
                    <!-- Email帳號 -->
                    <div class="mb-3">
                        <label for="emailChange" class="form-label">Email帳號: *不可更改</label>
                        <input type="email" class="form-control" id="emailChange" readonly>
                    </div>
                    <!-- 密碼 -->
                    <div class="mb-3">
                        <label for="password" class="form-label">密碼:</label>
                        <input type="password" class="form-control" id="password">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="showPassword"
                                onclick="togglePassword()">
                            <label class="form-check-label" for="showPassword">顯示密碼</label>
                        </div>
                    </div>
                    <!-- 手機號碼 -->
                    <div class="mb-3">
                        <label for="phone_number" class="form-label">手機號碼:</label>
                        <input type="tel" class="form-control" id="phone_number" value="098*****10">
                    </div>
                    <!-- 更新按鈕 -->
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-success" id="updateProfile">更新</button>
                    </div>
                </form>
            </div>
        </div>
    </div>






    <!-- 寫入 會員資料 -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var currentUser = JSON.parse(localStorage.getItem("currentUser"));
            var username = currentUser.email;
            var password = currentUser.password;
            $.get("/membership", { username: username, password: password })
                .done(function (data) {
                    if (data.success) {
                        $("#en_fname").val(data.user.userfirstname)
                        $("#en_name").val(data.user.userlastname)
                        $("#cardLevel").html("綠卡")
                        $("#cardLevelName").text("GC")
                        $("#ch_fname").val(data.user.userchfname)
                        $("#ch_name").val(data.user.userchname)
                        $("#emailChange").val(data.user.email)
                        $("#phone_number").val(data.user.phone)
                        $("#password").val(data.user.password)
                        $("#cardID").text(data.user.cardID)
                        $("#cardIDch").text(data.user.cardID)

                        // 進度條 
                        var factortmile = data.user.mileage;
                        var maxmile =  $("#mileagebar").attr("aria-valuemax")
                        var mileagePercentage = (parseInt(factortmile)/parseInt( maxmile)) * 100;



                        var factortCount = data.user.fligtcount;
                        var maxCount = $("#fligtcountbar").attr("aria-valuemax")
                        var countPercentage = (parseInt(factortCount)/parseInt(maxCount)) * 100;
                        console.log(factortCount)
                        $("#mileage").text(data.user.mileage)
                        $("#mileagebar").css("width", mileagePercentage + "%")
                        $("#fligtcount").text(data.user.fligtcount  )
                        $("#fligtcountbar").css("width",countPercentage + "%")



                    }
                    else {
                        alert("錯誤", data)
                    }
                })


        })


    </script>




    <script>
        // 這邊使用切換表讓使用者能看到密碼
        function togglePassword() {
            var passwordField = document.getElementById("password");
            if (passwordField.type === "password") {
                passwordField.type = "text";
            } else {
                passwordField.type = "password";
            }
        }

        $("#profileChange").on("click", function () {
            $("#profileData").toggle();
        });








        // 將資料丟到後端去做更新的動作
        $("#updateProfile").on("click", function (event) {
            var currentUser = JSON.parse(localStorage.getItem("currentUser"));
            // 防止跳轉
            event.preventDefault();
            var DATA = {
                userfirstname: $("#en_fname").val(),
                userlastname: $("#en_name").val(),
                userchfname: $("#ch_fname").val(),
                userchname: $("#ch_name").val(),
                email: $("#emailChange").val(),
                phone: $("#phone_number").val(),
                password: $("#password").val()

            }
            $.ajax({
                type: "put",
                url: "/profileChange",
                data: JSON.stringify(DATA),
                contentType: "application/json",
                success: function (response) {
                    // 得到用戶更新後的訊息
                    $.get("/membership", { username: DATA.email, password: DATA.password })
                        .done(function (data) {
                            if (data.success) {
                                // 更新localstorage中的訊息
                                localStorage.setItem("currentUser", JSON.stringify(data.user)); // 成功給訊息
                                alert("更新完成！");
                                //  重新整理頁面
                                window.location.reload();
                            }
                        })
                        .fail(function (error) {
                            console.error("Error fetching user data", error);
                        });
                },
                error: function (error) {
                    // 錯誤給訊息
                    alert("更新失敗!" + error);
                }
            });

        })






        //檢查是否登入 並給予名字(其他頁面需要)
        var currentUser = JSON.parse(localStorage.getItem("currentUser"));
        if (currentUser) {
            // 用户已登录，显示用户名
            var genderTtitle = currentUser.gender === "男" ? "先生" : "女士";
            var userLoginName = currentUser.userchfname + genderTtitle;
            $("#toLogin").css("visibility", "hidden")
            $("#loginop").css("visibility", "visible")
            $("#username").text(userLoginName)
        } else {
            // 用户未登录
            console.log("未登入狀態");
            $("#toLogin").css("visibility", "visible"); // 显示登录按钮
            $("#loginop").css("visibility", "hidden");
        }


    </script>
    <!-- 這是登入切換得js -->
    <script>


        document.addEventListener("DOMContentLoaded", function () {
            // 获取页面元素
            var userInfo = document.getElementById("user-info");
            var dropdownContent = document.getElementById("dropdown-content");
            var profileLink = document.getElementById("profile-link");
            var logoutLink = document.getElementById("logout-link");

            // 假设用户已登录，设置用户名
            var username = localStorage.getItem("username");

            if (username) {
                document.getElementById("username").innerText = username;
            }

            // 用户信息点击事件，显示/隐藏下拉菜单
            userInfo.addEventListener("click", function () {
                dropdownContent.style.display = dropdownContent.style.display === "block" ? "none" : "block";
            });

            // 会员页面链接点击事件
            profileLink.addEventListener("click", function () {
                // 如果用户已登录，重定向到会员页面

                window.location.href = "./membership.html";

            });

            // 登出链接点击事件
            logoutLink.addEventListener("click", function () {
                // 清除登录状态和用户名
                localStorage.removeItem("currentUser");

                // 重定向到登录页面
                window.location.href = "./login.html";
            });
        });
    </script>
    <!-- 返回頂部按鈕 -->
    <a href="#top" target="" style="cursor: pointer;">
        <figure id="smart" class="position-fixed bottom-0 end-0">
            <img src="./img/bot.gif" style="object-fit: contain; height: 70px; width:70px; z-index: 1;">
            <figcaption style="font-size:17px; text-align: center;"></figcaption>
        </figure>
    </a>
    <script type="text/javascript" src="./js資料庫/向上移動.js"></script>
</body>

</html>